7. 병렬 데이터 처리와 성능
7.1 병렬 스트림
- 스트림 인터페이스를 이용하면 아주 간단하게 요소를 병렬로 처리할 수 있다.
    - 컬렉션에 parallelStream을 호출하면 병렬스트림(parallel stream)이 생성된다.
- 병렬 스트림이란?
    - 각각의 스레드에서 처리할 수 있도록 스트림 요소를 여러 청크로 분할한 스트림.
    - 병렬 스트림을 이용하면 모든 멀티코어 프로세서가 각각의 청크를 처리하도록 할당할 수 있다.

7.1.4 병렬 스트림 효과적으로 사용하기
- 확신이 서지 않는다면 직접 측정하라.
    - 순차 스트림을 병렬 스트림으로 쉽게 바꿀 수 있다.
    - 무조건 병렬 스트림으로 바꾸는 것이 능사는 아니다.
    - 병렬 스트림의 수행과정은 투명하지 않을 때가 많다.
    - 순차 스트림과 병렬 스트림 중 어떤 것이 좋을지 모르겠다면 적절한 벤치마크로 직접 성능을 측정하는 것이 바람직하다.

- 박싱을 주의하라.
    - 자동 박싱과 언박싱은 성능을 크게 저하시킬 수 있는 요소다.
    - 자바 8은 박싱 동작을 피할 수 있도록 기본형 특화 스트림을 제공한다.
    - IntStream, LongStream, DoubleStream

- 순차 스트림보다 병렬 스트림에서 성능이 떨어지는 연산이 있다.
    - 특히 limit나 findFirst처럼 요소의 순서에 의존하는 연산을 병렬 스트림에서 수행하려면 비싼 비용을 치러야 한다.
        - 예를들어, findAny는 요소의 순서와 상관 없이 연산하므로 findFirst보다 성능이 좋다.
    - 정렬된 스트림에 unordered를 호출하면 비정렬된 스트림을 얻을 수 있다.
    - 요소의 순서가 상관 없다면 비정렬된 스트림에 limit를 호출하는 것이 더 효율적이다.

- 스트림에서 수행하는 전체 파이프라인 연산 비용을 고려하라.
    - 전체 스트림 파이프 라인 처리 비용 = N * Q
        - N : 처리해야할 요소 수
        - Q : 하나의 요소를 처리하는데 드는 비용
    - Q가 높아진다는 것은 병렬 스트림으로 성능을 개선할 수 있는 가능성이 있음을 의미한다.

- 소량의 데이터에서는 병렬 스트림이 도움 되지 않는다.
    - 병렬화 과정에서 생기는 부가 비용을 상쇄할 수 있을 만큼의 이득을 얻지 못한다.

- 스트림을 구성하는 자료구조가 적절한지 확인하라.
    - 예를 들어 ArrayList를 LinkedList보다 효율적으로 분할할 수 있다.
        - LinkedList를 분할하려면 모든 요소를 탐색해야 하지만 ArrayList는 요소를 탐색하지 않고도 리스트를 분할할 수 있기 때문.
    - range 팩토리 메서드로 만든 기본형 스트림도 쉽게 분해할 수 있다.
    - 커스텀 Spliterator를 구현해서 분해 과정을 완벽하게 제어할 수 있다.

- 스트림의 특성과 파이프라인의 중간 연산이 스트림의 특성을 어떻게 바꾸는지에 따라 분해 과정의 성능이 달라질 수 있다.
    - 예를 들어 SIZED 스트림은 정확히 같은 크기의 두 스트림으로 분할 할 수 있으므로 효과적으로 스트림을 병렬처리할 수 있다.
    - 반면 필터 연산이 있으면 스트림의 길이를 예측할 수 없으므로 효과적으로 스트림을 병렬처리할 수 있을지 알 수 없게 된다.

- 최종 연산의 병합 과정 비용을 살펴보라.
    - 병합 과정의 비용이 비싸다면 병렬 스트림으로 얻은 성능의 이익이 서브스트림의 부분결과를 합치는 과정에서 상쇄될 수 있다.

- 병렬 스트림이 수행되는 내부 인프라구조도 살펴봐야 한다.
    - 자바 7에서 추가된 포크/조인 프레임워크로 병렬 스트림이 처리된다.

7.2 포크/조인 프레임워크

7.3 Spliterator
